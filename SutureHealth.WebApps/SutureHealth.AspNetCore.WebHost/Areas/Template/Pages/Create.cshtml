@page
@model SutureHealth.AspNetCore.Areas.Template.Pages.CreateModel
@{
    Model.RequireKendo = true;
    Model.RequireValidation = true;
}

@section Styles
{
<link rel="stylesheet" href="~/css/CreateTemplate.min.css" asp-append-version="true" />
}
@section Scripts {
<script src="~/js/TemplateCreate.js" asp-append-version="true"></script>
}

<section class="py-4">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-5">
                <h4>Instructions</h4>
                <hr>
                <ul class="list-unstyled icon-list">
                    <li class="pt-3">
                        <h5><i class="fas text-primary fa-file-medical-alt" aria-hidden="true"></i> Select a template type.</h5>
                    </li>
                    <li class="pt-3">
                        <h5><i class="far text-primary fa-file-upload"></i> Upload a sample form as a background for creating the template.</h5>
                    </li>
                    <li class="pt-3">
                        <h5><i class="fal text-primary fa-file-signature"></i> Enter a custom template name.</h5>
                    </li>
                </ul>
                <div class="alert mt-5 alert-primary" role="alert">
                    <h6 class="alert-heading"><i class="far fa-lightbulb"></i> Tip! <span class="small">Templates are shared across your facility.</span></h6>
                </div>
            </div>
            <div class="col-12 col-md-7">
                <div class="shadow">
                    <div class="p-3">
                        <h4>Create Template</h4>
                        <hr />
                        <form method="post" enctype="multipart/form-data">
                            @if (Model.HasMultipleOrganizations)
                            {
                                <div class="form-group row">
                                    <label for="staticEmail" class="col-sm-3 col-form-label">Office</label>
                                    <div class="col-sm-9">
                                        <kendo-dropdownlist for="OrganizationId" bind-to="Model.Offices" value="@Model.OrganizationId" datatextfield="Name" datavaluefield="OrganizationId" on-change="OfficeChanged" />
                                        <span asp-validation-for="OrganizationId" class="text-danger"></span>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <input asp-for="OrganizationId" type="hidden" value="@Model.OrganizationId" />
                            }
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Template Type</label>
                                <div class="col-sm-9">
                                    <kendo-dropdownlist for="TemplateTypeId" datatextfield="Name" datavaluefield="TemplateTypeId" on-change="TemplateTypeChanged" height="600">
                                        <datasource type="DataSourceTagHelperType.Ajax" on-change="TemplateTypeDataSourceChanged" server-aggregates="false" server-filtering="true" server-grouping="false" server-sorting="false" server-paging="false">
                                            <transport>
                                                <read url="@Url.Page("/Create", "TemplateTypes", new { area = "Template" })" type="get" data="TemplateTypeReadParameters" />
                                            </transport>
                                            <groups>
                                                <group field="Category" />
                                            </groups>
                                        </datasource>
                                    </kendo-dropdownlist>
                                    <span asp-validation-for="TemplateTypeId" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Upload Sample Form</label>
                                <div class="col-sm-9">
                                    <kendo-upload multiple="false" name="PdfContents">
                                        <validation allowed-extensions="@(new string[] { ".pdf" })" max-file-size="Model.MaxUploadBytes" />
                                        <localization select="Choose File" />
                                    </kendo-upload>
                                    <span asp-validation-for="PdfContents" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-3 col-form-label">Internal Name</label>
                                <div class="col-sm-9">
                                    <input-form-group asp-for="InternalName">
                                        <input type="text" class="form-control" asp-for="InternalName" placeholder="Internal Name" maxlength="100" />
                                        <span asp-validation-for="InternalName" class="text-danger"></span>
                                    </input-form-group>
                                </div>
                            </div>
                            <div class="row my-5 form-group">
                                <div class="row justify-content-center">
                                    <div class="col-6 col-md-4">
                                        <div class="d-grid">
                                            <button class="btn btn-primary" type="submit">Next</button>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="d-grid">
                                            <button id="CancelButton" class="btn btn-secondary" data-url="@(Model.CurrentUser.IsApplicationAdministrator() ? Url.RouteUrl("AdminTemplateOrganizationSearch", new { organizationId = Model.OrganizationId }) : Url.RouteUrl("SendIndex", new { contentOnly = true }))" type="button">Cancel</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="@Html.IdFor(m => m.ExistingTemplateNames)" name="@Html.NameFor(m => m.ExistingTemplateNames)" value="@Model.ExistingTemplateNames" />
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
